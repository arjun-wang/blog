## mysql 事务

#### 事务的四大特性（ACID）

1. A 原子性：要么都成功要么都撤销

2. C 一致性：事务将数据库从一种状态转变为另一种一致的状态，在事务开始之前和事务结束以后，数据库的完整性约束没有被破坏

3. I 隔离性：事务的隔离性要求每个读写事务的对象与其它事务的操作对象能相互分离，即该事务提交前对其它事务都不可见，这通常使用锁来实现

4. D 持久性：表示事务一旦提交了，其结果就是永久性的，也就是数据就已经写入到数据库了，如。果发生了宕机等事故，数据库也能将数据恢复。


#### 事务级别

为了有效保证并发读取数据的正确性

InnoDB：(默认REPEATABLE READ)

1. READ UNCOMMITTED(未提交读)
2. READ COMMITTED(已提交读)
3. REPEATABLE READ(可重复读)
4. SERIALIZABLE(可串行化)

隔离级别  | 脏读（Dirty Read）| 不可重复读（NonRepeatable Read）| 幻读（Phantom Read）
---------| -------------| ------------- | -------------
未提交读  | 可能    | 可能   | 可能
已提交读  | 不可能  | 可能   | 可能
可重复读  | 不可能  | 不可能 | 可能
可串行化  | 不可能  | 不可能 | 不可能


脏读：
	一个事务读取到了另外一个事务没有提交的数据；比如：事务T1更新了一行记录的内容，但是并没有提交所做的修改。事务T2读取到了T1更新后的行，然后T1执行回滚操作，取消了刚才所做的修改。现在T2所读取的行就无效了；

不可重复读：
	在同一事务中，两次读取同一数据，得到内容不同；比如：事务T1读取一行记录，紧接着事务T2修改了T1刚才读取的那一行记录。然后T1又再次读取这行记录，发现与刚才读取的结果不同。这就称为“不可重复”读，因为T1原来读取的那行记录已经发生了变化；

幻读：
	同一事务中，用同样的操作读取两次，得到的记录数不相同；比如：事务T1读取一条指定的WHERE子句所返回的结果集。然后事务T2新插入 一行记录，这行记录恰好可以满足T1所使用的查询条件中的WHERE子句的条件。然后T1又使用相同的查询再次对表进行检索，但是此时却看到了事务T2刚才插入的新行。这个新行就称为“幻像”，因为对T1来说这一行就像突然出现的一样。

我们可以可以用SET TRANSACTION语句改变单个会话或者所有新进连接的隔离级别。它的语法如下：

	set session transaction isolation level repeatable read;